<?xml version="1.0"?>
<!-- from HAL V. Engel's p51d-->

<system name="Propulsion">
    
    <property type="double" value="0">oil-powergain-factor-calc</property>

    <channel name="engine power">
    

        <!--controls fuel flow depending on density altitude-->
        -<fcs_function name="systems/engine/MP-alt-volumetric-efficiency-curve">
          <function>
                <table>
                    <independentVar lookup="row">atmosphere/density-altitude</independentVar>
                    <independentVar lookup="column">propulsion/engine/map-inhg</independentVar>
                    <tableData breakPoint="0">
			14	15	16	17	18	19	20	21	22	23	24	25	26	27	28	28.5
		0	0.15	0.25	0.36	0.46	0.56	0.66	0.761	0.763	0.764	0.772 0.78	0.79	0.78	0.80	0.86 0.88
		2000	0.15	0.280	0.380	0.480	0.580	0.680	0.780	0.780	0.790	0.800	0.804	0.81	0.8	0.785	0.885	0.86   
		4000	0.15	0.747	0.747	0.747	0.747	0.747	0.747	0.748	0.755	0.762	0.77	0.77	0.77	0.77	0.77	0.77
		6000	0.15	0.755	0.755	0.755	0.755	0.755	0.755	0.76	0.77	0.78	0.78	0.78	0.78	0.78	0.78	0.78	  
		8000	0.15	0.765	0.765	0.765	0.765	0.765	0.765	0.77	0.77	0.77	0.77	0.77	0.77	0.77	0.77	0.77	
		10000 0.15	0.75	0.75	0.75	0.75	0.76	0.76	0.76	0.76	0.76	0.76	0.76	0.76	0.76	0.76	0.76   
		12000 0.15	0.74	0.74	0.75	0.755	0.755	0.755	0.755	0.755	0.755	0.755	0.755	0.755	0.755	0.755	0.755	 
		14000 0.15	0.76	0.76	0.76	0.76	0.76	0.76	0.76	0.76	0.76	0.76	0.76	0.76	0.76	0.76	0.76   
                   </tableData> 
                </table>  
          </function>
          <output>propulsion/engine/volumetric-efficiency</output>   
        </fcs_function>

        <!--controls power depending on density altitude-->
        <fcs_function name="systems/engine/MP-alt-bsfc-lbs_hphr-curve">
          <function>
             <product>
                <table>
                    <independentVar lookup="row">atmosphere/density-altitude</independentVar>
                    <independentVar lookup="column">propulsion/engine/map-inhg</independentVar>
                    <tableData breakPoint="0">
				15	16	17	18	19	20	21	22	23	24	25	26	27	28	28.5
		0		0.29	0.29	0.29	0.29	0.29	0.298	0.298	0.302	0.306	0.311	0.317	0.317	0.35 0.443 0.443
		2000		0.296	0.296	0.296	0.296	0.296	0.296	0.300	0.303	0.310	0.315	0.317	0.35	0.428	0.428	0.428		
		4000		0.34	0.34	0.34	0.34	0.34	0.34	0.34 0.34 0.40 0.425 0.425 0.425 0.428 0.428 0.428	
		6000		0.301	0.301	0.301	0.301	0.301	0.301	0.302	0.402	0.402	0.412	0.422	0.422	0.422	0.422	0.422
		8000		0.41	0.41	0.41	0.414	0.41	0.41	0.414	0.414	0.414	0.414	0.414	0.414	0.414	0.414	0.414
		10000	0.409	0.409	0.409	0.409	0.409	0.409	0.409	0.409	0.409	0.409	0.409	0.409	0.409	0.409	0.409	 
		12000	0.413	0.413	0.413	0.413	0.413	0.413	0.413	0.413	0.413	0.413	0.413	0.413	0.413	0.413	0.413	
		14000	0.403	0.405	0.405	0.405	0.405	0.405	0.405	0.405	0.405	0.405	0.405	0.405	0.405	0.405	0.405
                   </tableData>
                </table>
                
                <property>/engines/engine/oil-powergain-factor</property> <!-- cold oil = less power -->
            </product>
          </function>
          <clipto>
             <min> 0.0 </min>
             <max> 1.00 </max>
           </clipto>
          <output>propulsion/engine/bsfc-lbs_hphr</output>
        </fcs_function>
	
 <fcs_function name="systems/engine/RAM-Air-Factor">
          <function>
                <table>
                    <independentVar lookup="row">atmosphere/density-altitude</independentVar>
                    <tableData breakPoint="0">
					
                        0		0.1		
                        2000	0.2		
                        4000	0.3		
                        6000	0.6		
                        8000	0.9		
                        10000	0.99		 
                        12000	0.99	
                        14000	0.99	
                   </tableData>
                </table>  
          </function>
          <clipto>
             <min> 0.0 </min>
             <max> 1.00 </max>
           </clipto>
          <output>propulsion/engine/ram-air-factor</output>   
        </fcs_function>
        
        
        <!-- OIL Power gain factor -->
        <!-- (cold oil makes the engine output less power due to reduced viscosity/increased friction) -->
        <!-- This also simulates "running the engine warm" -->
        <switch name="engines/engine/oil-powergain-factor">
            <default value="1"/>
            <test logic="AND" value="oil-powergain-factor-calc">
                /engines/engine/complex-engine-procedures EQ 1
                /engines/engine/allow-oil-management EQ 1
                /sim/start-state-internal/oil-temp-override EQ 0
            </test>
            <output>/engines/engine/oil-powergain-factor</output>
        </switch>
        <fcs_function name="oil-powergain-factor-calc">
            <function>
                <table>
                    <independentVar lookup="row">/engines/engine[0]/oil-temperature-degf</independentVar>
                    <tableData breakPoint="0">
                        19.4   2.00   <!-- -7°C -->
                        90.0   1.00   <!-- 32°C --> <!-- engine is considered "hot" -->
                    </tableData>
                </table>  
            </function>
            <clipto>
                <min> 1.0 </min>  <!-- 1=no more better; <1 is boost! -->
                <max> 1.5 </max>  <!-- bigger=less power -->
            </clipto>
            <output>oil-powergain-factor-calc</output>
        </fcs_function>

    </channel>
</system>
